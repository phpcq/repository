{"bootstraps":{"bootstrap-0":{"plugin-version":"1.0.0","type":"inline","code":"<?php\n\nuse Phpcq\\PluginApi\\Version10\\Configuration\\PluginConfigurationBuilderInterface;\nuse Phpcq\\PluginApi\\Version10\\Configuration\\PluginConfigurationInterface;\nuse Phpcq\\PluginApi\\Version10\\DiagnosticsPluginInterface;\nuse Phpcq\\PluginApi\\Version10\\EnvironmentInterface;\nuse Phpcq\\PluginApi\\Version10\\Output\\OutputTransformerFactoryInterface;\nuse Phpcq\\PluginApi\\Version10\\Output\\OutputTransformerInterface;\nuse Phpcq\\PluginApi\\Version10\\Report\\ToolReportInterface;\nuse Phpcq\\PluginApi\\Version10\\Util\\BufferedLineReader;\n\nreturn new class implements DiagnosticsPluginInterface {\n    public function getName(): string\n    {\n        return 'box';\n    }\n\n    public function describeConfiguration(PluginConfigurationBuilderInterface $configOptionsBuilder): void\n    {\n        // See https://github.com/humbug/box/blob/master/doc/configuration.md\n\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#signing-algorithm-algorithm\n        $configOptionsBuilder\n            ->describeStringOption(\n                'algorithm',\n                <<<EOF\n                The algorithm setting is the signing algorithm to use when the PHAR is built\n                (Phar::setSignatureAlgorithm()).\n\n                The following is a list of the signature algorithms available:\n                MD5\n                SHA1\n                SHA256\n                SHA512\n                OPENSSL\n                By default PHARs are SHA1 signed.\n\n                The OPENSSL algorithm will require to provide a key.\n\n                EOF\n            )\n            ->withDefaultValue('SHA1');\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#alias-alias\n        $configOptionsBuilder\n            ->describeStringOption(\n                'alias',\n                <<<EOF\n                The alias setting is used when generating a new stub to call the Phar::mapPhar().\n                This makes it easier to refer to files in the PHAR and ensure the access to internal files will always\n                work regardless of the location of the PHAR on the file system.\n                If no alias is provided, a generated unique name will be used for it in order to map the main file.\n                Note that this may have undesirable effects if you are using the generated stub.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#annotations-annotations\n        // FIXME: this can also be a hash map with another hash map at key \"ignore\"\n        // FIXME: using the names of the annotations as keys of the sub map. How to address?\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'annotations',\n                <<<EOF\n                The annotations setting is used to enable compacting annotations in PHP source code.\n                This setting is only taken into consideration if the KevinGH\\Box\\Compactor\\Php compactor is enabled.\n                By default, it removes all non real-like annotations from the PHP code.\n\n                EOF\n            )\n            ->withDefaultValue(true);\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#banner-banner\n        $configOptionsBuilder\n            ->describeStringOption(\n                'banner',\n                <<<EOF\n                The banner setting is the banner comment that will be used when a new stub is generated.\n                The value of this setting must not already be enclosed within a comment block as it will be\n                automatically done for you.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#banner-file-banner-file\n        $configOptionsBuilder\n            ->describeStringOption(\n                'banner_file',\n                <<<EOF\n                The banner-file setting is like banner, except it is a path (relative to the base path) to the file\n                that will contain the comment.\n                Like banner, the comment must not already be enclosed in a comment block.\n                If this parameter is set to a different value than null, then the value of banner will be discarded.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#base-path-base-path\n        // NOT SUPPORTED, AS WE CREATE THE CONFIG IN TEMP LOCATION AND THEREFORE NEED TO PASS THE PROJECT ROOT HERE.\n        /*\n        $configOptionsBuilder\n            ->describeStringOption(\n                'base_path',\n                <<<EOF\n                The base-path setting is used to specify where all of the relative file paths should resolve to.\n                This does not, however, alter where the built PHAR will be stored (see: output).\n                If set to null or not specified, the base path used is the directory containing the configuration\n                file when a specific configuration file is given or the current working directory otherwise.\n\n                EOF\n            )\n        */\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#blacklist-blacklist\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'blacklist',\n                <<<EOF\n                The blacklist setting is a list of files that must not be added.\n                The files blacklisted are the ones found using the other available configuration settings:\n                files, files-bin, directories, directories-bin, finder, finder-bin.\n\n                Note that all the blacklisted paths are relative to the settings configured above.\n\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#check-requirements-check-requirements\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'check_requirements',\n                <<<EOF\n                The check requirements setting is used to allow the PHAR to check for the application constraint before\n                running. See more information about it here. If not set or set to null, then the requirement checker\n                will be added. Note that this is true only if either the composer.json or composer.lock could have been\n                found.\n\n                Warning: this check is still done within the PHAR. As a result, if the required extension to open the\n                PHAR due to the compression algorithm is not loaded, a hard failure will still appear: the requirement\n                checker cannot be executed before that.\n\n                EOF\n            )\n            ->withDefaultValue(true)\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#permissions-chmod\n        $configOptionsBuilder\n            ->describeStringOption(\n                'chmod',\n                <<<EOF\n                The chmod setting is used to change the file permissions of the newly built PHAR. The string contains\n                an octal value e.g. 0750. By default the permissions of the created PHAR are unchanged so it should be\n                0644.\n                Check https://secure.php.net/manual/en/function.chmod.php for more on the possible values.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#compactors-compactors\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'compactors',\n                <<<EOF\n                The compactors setting is a list of file contents compacting classes that must be registered.\n                A file compacting class is used to reduce the size of a specific file type.\n                The following compactors are included with Box:\n                - KevinGH\\Box\\Compactor\\Json: compress JSON files\n                - KevinGH\\Box\\Compactor\\Php: strip down classes from phpdocs & comments\n                - KevinGH\\Box\\Compactor\\PhpScoper: isolate the code using PHP-Scoper\n\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#compression-algorithm-compression\n        $configOptionsBuilder\n            ->describeStringOption(\n                'compression',\n                <<<EOF\n                The compression (string|null default NONE) setting is the compression algorithm to use when the PHAR is\n                built. The compression affects the individual files within the PHAR and not the PHAR as a whole\n                (Phar::compressFiles()).\n                The following is a list of the signature algorithms available:\n                - GZ (the most efficient most of the time)\n                - BZ2\n                - NONE (default)\n                Warning: be aware that if compressed, the PHAR will required the appropriate extension (zlib for GZ and\n                bz2 for BZ2) to execute the PHAR. Without it, PHP will not be able to open the PHAR at all.\n                EOF\n            )\n            ->isRequired()\n            ->withDefaultValue('NONE');\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#datetime-placeholder-datetime\n        $configOptionsBuilder\n            ->describeStringOption(\n                'datetime',\n                <<<EOF\n                The datetime setting is the name of a placeholder value that will be replaced in all non-binary files\n                by the current datetime. If no value is given (null) then this placeholder will be ignored.\n                The format of the date used is defined by the datetime_format setting.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#datetime-placeholder-format-datetime-format\n        $configOptionsBuilder\n            ->describeStringOption(\n                'datetime_format',\n                <<<EOF\n                The datetime format placeholder setting accepts a valid PHP date format.\n                It can be used to change the format for the datetime setting.\n\n                EOF\n            )\n            ->withDefaultValue('Y-m-d H:i:s T')\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#directories-directories-and-directories-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'directories',\n                <<<EOF\n                The directories setting is a list of directory paths relative to base-path.\n                All files will be processed by the compactors, have their placeholder values replaced\n                (see: replacements) and added to the PHAR.\n                Files listed in the blacklist will not be added to the PHAR.\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#directories-directories-and-directories-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'directories_bin',\n                <<<EOF\n                The directories_bin setting is analogue to directories except the files are added to the PHAR\n                unmodified. This is suitable for the files such as images, those that contain binary data or simply a\n                file you do not want to alter at all despite using compactors.\n\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#dumping-the-composer-autoloader-dump-autoload\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'dump_autoload',\n                <<<EOF\n                The dump_autoload setting will result in Box dump the Composer autoload with the classmap authoritative\n                mode and the --no-dev option which disables the autoload-dev rules.\n                This is however done only if a composer.json file could be found. If a composer.lock file is found as\n                well, the file vendor/composer/installed.json will be required too.\n                The dumping of the autoloader will be ignored if the composer.json file could not be found.\n                The autoloader is dumped at the end of the process to ensure it will take into account the eventual\n                modifications done by the compactors process.\n\n                EOF\n            )\n            ->isRequired()\n            ->withDefaultValue(true);\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#excluding-the-composer-files-exclude-composer-files\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'exclude_composer_files',\n                <<<EOF\n                The exclude-composer-files setting will result in removing the Composer files composer.json,\n                composer.lock and vendor/composer/installed.json if they are found regardless of whether or not they\n                were found by Box alone or explicitly included.\n\n                EOF\n            )\n            ->isRequired()\n            ->withDefaultValue(true);\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#excluding-the-composer-files-exclude-composer-files\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'exclude_dev_files',\n                <<<EOF\n                The exclude-dev-files (bool default true) setting will, when enabled, cause Box to attempt to exclude\n                the files belonging to dev only packages.\n                This setting will automatically be disabled when dump-autoload is disabled. Indeed, otherwise some files\n                will not be shipped in the PHAR but may still appear in the Composer autoload classmap, resulting in an\n                autoloading error.\n\n                EOF\n            )\n            ->isRequired()\n            ->withDefaultValue(true);\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#files-files-and-files-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'files',\n                <<<EOF\n                The files setting is a list of files paths relative to base-path unless absolute. Each file will be\n                processed by the compactors, have their placeholder values replaced (see: replacements) and added to the\n                PHAR.\n                This setting is not affected by the blacklist setting.\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#files-files-and-files-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'files_bin',\n                <<<EOF\n                files-bin is analogue to files except the files are added to the PHAR unmodified.\n                This is suitable for the files such as images, those that contain binary data or simply a file you do\n                not want to alter at all despite using compactors.\n\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#finder-finder-and-finder-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'finder',\n                <<<EOF\n                The finder setting is a list of JSON objects. Each object (key, value) tuple is a (method, arguments) of\n                the Symfony Finder used by Box. If an array of values is provided for a single key, the method will be\n                called once per value in the array.\n                Note that the paths specified for the in method are relative to base-path and that the finder will\n                account for the files registered in the blacklist.\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#finder-finder-and-finder-bin\n        $configOptionsBuilder\n            ->describeStringListOption(\n                'finder_bin',\n                <<<EOF\n                finder-bin is analogue to finder except the files are added to the PHAR unmodified.\n                This is suitable for the files such as images, those that contain binary data or simply a file you do\n                not want to alter at all despite using compactors.\n\n                EOF\n            )\n            ->withDefaultValue([])\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#force-auto-discovery-force-autodiscovery\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'force_autodiscovery',\n                <<<EOF\n                The force-autodiscovery setting forces Box to attempt to find which files to include even though you\n                are using the directories or finder setting.\n                When Box tries to find which files to include, it may remove some files such as readmes or test files.\n                If however you are using the directories or finder, Box will append the found files to the ones you\n                listed.\n\n                EOF\n            )\n            ->withDefaultValue(false)\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#pretty-git-tag-placeholder-git\n        $configOptionsBuilder\n            ->describeStringOption(\n                'git',\n                <<<EOF\n                The git tag placeholder setting is the name of a placeholder value that will be replaced in all\n                non-binary files by the current git tag of the repository.\n                Example of value the placeholder will be replaced with:\n                - \"2.0.0\" on an exact tag match\n                - \"2.0.0@e558e33\" on a commit following a tag\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#git-commit-placeholder-git-commit\n        $configOptionsBuilder\n            ->describeStringOption(\n                'git_commit',\n                <<<EOF\n                The git commit setting is the name of a placeholder value that will be replaced in all non-binary files\n                by the current git commit hash of the repository.\n                Example of value the placeholder will be replaced with: e558e335f1d165bc24d43fdf903cdadd3c3cbd03\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#short-git-commit-placeholder-git-commit-short\n        $configOptionsBuilder\n            ->describeStringOption(\n                'git_commit_short',\n                <<<EOF\n                The short git commit setting is the name of a placeholder value that will be replaced in all non-binary\n                files by the current git short commit hash of the repository.\n                Example of value the placeholder will be replaced with: e558e33\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#git-tag-placeholder-git-tag\n        $configOptionsBuilder\n            ->describeStringOption(\n                'git_tag',\n                <<<EOF\n                The git tag placeholder (string|null default null) setting is the name of a placeholder value that will\n                be replaced in all non-binary files by the current git tag of the repository.\n                Example of value the placeholder will be replaced with:\n                - \"2.0.0\" on an exact tag match\n                - \"2.0.0-2-ge558e33\" on a commit following a tag\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#git-version-placeholder-git-version\n        $configOptionsBuilder\n            ->describeStringOption(\n                'git_version',\n                <<<EOF\n                The git version setting is the name of a placeholder value that will be replaced in all non-binary files\n                by the one of the following (in order):\n                - The git repository's most recent tag.\n                - The git repository's current short commit hash.\n                - The short commit hash will only be used if no tag is available.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#intercept-intercept\n        $configOptionsBuilder\n            ->describeBoolOption(\n                'intercept',\n                <<<EOF\n                The intercept setting is used when generating a new stub.\n                If setting is set to true, the Phar::interceptFileFuncs() method will be called in the stub.\n\n                EOF\n            )\n            ->withDefaultValue(false)\n            ->isRequired();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#the-private-key-key\n        $configOptionsBuilder\n            ->describeStringOption(\n                'key',\n                <<<EOF\n                The key setting is used to specify the path to the private key file. The private key file will be used\n                to sign the PHAR using the OPENSSL signature algorithm (see Signing algorithm) and the setting will be\n                completely ignored otherwise. If an absolute path is not provided, the path will be relative to the\n                current working directory.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#the-private-key-password-key-pass\n        $configOptionsBuilder\n            ->describeStringOption(\n                'key_pass',\n                <<<EOF\n                The private key password setting is used to specify the pass-phrase for the private key. If a string is\n                provided, it will be used as is as the pass-phrase.\n                If \"ENV::<name>\" is provided, the environment variable \"name\" will get used to prevent leakage of the\n                password.\n                This setting will be ignored if no key has been provided.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#main-main\n        $configOptionsBuilder\n            ->describeStringOption(\n                'main',\n                <<<EOF\n                The main setting is used to specify the file (relative to base-path) that will be run when the PHAR is\n                executed from the command line (To not confuse with the stub which is the PHAR\n                bootstrapping file).\n\n                When you have a main script file that can be used as a stub, you can disable the main script by setting\n                it to empty string.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#map-map\n        // FIXME: I almost bet this is could be described better.\n        $configOptionsBuilder\n            ->describePrototypeOption(\n                'map',\n                <<<EOF\n                The map setting is used to change where some (or all) files are stored inside the PHAR. The key is a\n                beginning of the relative path that will be matched against the file being added to the PHAR. If the key\n                is a match, the matched segment will be replaced with the value. If the key is empty, the value will be\n                prefixed to all paths (except for those already matched by an earlier key).\n\n                EOF\n            )\n            ->ofStringValue();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#metadata-metadata\n        // FIXME: how shall we support THIS? - \"any\" value is evil.\n        $configOptionsBuilder\n            ->describeStringOption(\n                'metadata',\n                <<<EOF\n                The metadata setting can be any value. This value will be stored as metadata that can be retrieved from\n                the built PHAR (`Phar::getMetadata()).\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#output-output\n        $configOptionsBuilder\n            ->describeStringOption(\n                'output',\n                <<<EOF\n                The output setting specifies the file name and path of the newly built PHAR. If the value of the setting\n                is not an absolute path, the path will be relative to the base path.\n                If not provided or set to null, the default value used will based on the main. For example if the main\n                file is bin/acme.php or bin/acme then the output will be bin/acme.phar.\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#php-scoper-php-scoper\n        $configOptionsBuilder\n            ->describeStringOption(\n                'php_scoper',\n                <<<EOF\n                The PHP-Scoper setting points to the path to the PHP-Scoper configuration file. For more documentation\n                regarding PHP-Scoper, you can head to PHAR code isolation or PHP-Scoper official documentation.\n                Note: this setting is used only if the compactor KevinGH\\Box\\Compactor\\PhpScoper is registered.\n\n                EOF\n            )\n            ->withDefaultValue('scoper.inc.php');\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#replacement-sigil-replacement-sigil\n        $configOptionsBuilder\n            ->describeStringOption(\n                'replacement_sigil',\n                <<<EOF\n                The replacement sigil is the character or chain of characters used to delimit the placeholders.\n                See the @replacements setting for examples of placeholders.\n\n                EOF\n            )\n            ->withDefaultValue('@');\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#replacements-replacements\n        $configOptionsBuilder\n            ->describePrototypeOption(\n                'replacements',\n                <<<EOF\n                The replacements setting is a map of placeholders (as keys) and their values.\n                The placeholders are replaced in all non-binary files with the specified values.\n\n                EOF\n            )\n            ->isRequired()\n            ->withDefaultValue([])\n            ->ofStringValue();\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#shebang-shebang\n        $configOptionsBuilder\n            ->describeStringOption(\n                'shebang',\n                <<<EOF\n                The shebang setting is used to specify the shebang line used when generating a new stub.\n                By default, this line is used: `#!/usr/bin/env php`\n                The shebang line can be removed altogether if set to empty string.\n\n                EOF\n            );\n        // https://github.com/humbug/box/blob/master/doc/configuration.md#stub-stub\n        $configOptionsBuilder\n            ->describeStringOption(\n                'stub',\n                <<<EOF\n                The stub setting is used to specify the location of a stub file or if one should be generated:\n                - Path to the stub file will be used as is inside the PHAR\n                - generated: A new stub will be generated (default)\n                - empty string: The default stub used by the PHAR class will be used\n                If a custom stub file is provided, none of the other options: (shebang, intercept and alias) are used.\n\n                EOF\n            )\n            ->withDefaultValue('generated');\n    }\n\n    public function createDiagnosticTasks(\n        PluginConfigurationInterface $config,\n        EnvironmentInterface $buildConfig\n    ): iterable {\n        $contents = $this->buildConfig($config);\n        // AS WE CREATE THE CONFIG IN TEMP LOCATION, WE THEREFORE NEED TO PASS THE PROJECT ROOT HERE.\n        $contents['base-path'] = $buildConfig->getProjectConfiguration()->getProjectRootPath();\n\n        $json = json_encode($contents, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE);\n        // dump options to temporary config json.\n        $configFile = $buildConfig->getUniqueTempFile($this, 'box.json');\n        file_put_contents($configFile, $json);\n\n        yield $buildConfig\n            ->getTaskFactory()\n            ->buildRunPhar(\n                'box',\n                [\n                    'compile',\n                    '--config',\n                    $configFile,\n                    '-d',\n                    $buildConfig->getProjectConfiguration()->getProjectRootPath()\n                ]\n            )\n            ->withWorkingDirectory($buildConfig->getProjectConfiguration()->getProjectRootPath())\n            ->withOutputTransformer($this->createOutputTransformer($contents))\n            ->build();\n    }\n\n    private function buildConfig(PluginConfigurationInterface $config): array\n    {\n        static $stringMap = [\n            'algorithm'         => 'algorithm',\n            'alias'             => 'alias',\n            'banner'            => 'banner',\n            'banner_file'       => 'banner-file',\n            // Not supported atm as we need this internally to be able to specify an alternative config.\n            // 'base_path'      => 'base-path',\n            'chmod'             => 'chmod',\n            'compression'       => 'compression',\n            'datetime'          => 'datetime',\n            'datetime_format'   => 'datetime-format',\n            'git'               => 'git',\n            'git_commit'        => 'git-commit',\n            'git_commit_short'  => 'git-commit-short',\n            'git_tag'           => 'git-tag',\n            'git_version'       => 'git-version',\n            'key'               => 'key',\n            'metadata'          => 'metadata',\n            'output'            => 'output',\n            'php_scoper'        => 'php-scoper',\n            'replacement_sigil' => 'replacement-sigil',\n        ];\n\n        foreach ($stringMap as $configKey => $remappedKey) {\n            if ($config->has($configKey)) {\n                $contents[$remappedKey] = $config->getString($configKey);\n            }\n        }\n\n        static $boolMap = [\n            'annotations'            => 'annotations',\n            'check_requirements'     => 'check-requirements',\n            'dump_autoload'          => 'dump-autoload',\n            'exclude_composer_files' => 'exclude-composer-files',\n            'exclude_dev_files'      => 'exclude-dev-files',\n            'force_autodiscovery'    => 'force-autodiscovery',\n            'intercept'              => 'intercept',\n        ];\n\n        foreach ($boolMap as $configKey => $remappedKey) {\n            if ($config->has($configKey)) {\n                $contents[$remappedKey] = $config->getBool($configKey);\n            }\n        }\n\n        static $stringList = [\n            'blacklist'       => 'blacklist',\n            'compactors'      => 'compactors',\n            // FIXME: collision with our own key \"directories\"\n            // 'directories'  => 'directories',\n            'directories_bin' => 'directories-bin',\n            'files'           => 'files',\n            'files_bin'       => 'files-bin',\n            'finder'          => 'finder',\n            'finder_bin'      => 'finder-bin',\n        ];\n\n        foreach ($boolMap as $configKey => $remappedKey) {\n            if ($config->has($configKey)) {\n                $contents[$remappedKey] = $config->getStringList($configKey);\n            }\n        }\n\n        static $keyMap = [\n            'map' => 'map',\n        ];\n\n        $contents = [];\n\n        foreach ($keyMap as $configKey => $remappedKey) {\n            if (null !== $value = $config[$configKey] ?? null) {\n                $contents[$remappedKey] = $value;\n            }\n        }\n\n        // Specially handled keys here.\n        if ($config->has('main')) {\n            $value = $config->getString('main');\n            // Fixup empty string to false, as we do not allow type invariance in configuration.\n            $contents['main'] = ('' === $value) ? false : $value;\n        }\n\n        if ($config->has('key_pass')) {\n            $value = $config->getString('key_pass');\n            // Fixup environment variable usage:\n            if ('ENV::' === substr($value, 0, 5)) {\n                $value = getenv(substr($value, 5));\n            }\n\n            $contents['key-pass'] = $value;\n        }\n\n        if ($config->has('shebang')) {\n            $value = $config->getString('shebang');\n            // Fixup empty string to false, as we do not allow type invariance in configuration.\n            $contents['shebang'] = ('' === $value) ? false : $value;\n        }\n\n        if ($config->has('stub')) {\n            switch ($config->getString('stub')) {\n                case 'default':\n                    $value = true;\n                    break;\n                case '':\n                    $value = false;\n                    break;\n                default:\n            }\n\n            $contents['stub'] = $value;\n        }\n\n        if ($config->has('map')) {\n            $contents['map'] = $config->getOptions('map')->getValue();\n        }\n\n        if ($config->has('replacements')) {\n            $contents['replacements'] = $config->getOptions('replacements')->getValue();\n        }\n\n        ksort($contents);\n\n        return $contents;\n    }\n\n    private function createOutputTransformer(array $config): OutputTransformerFactoryInterface\n    {\n        if (isset($config['key-pass'])) {\n            // redact gpg-key password from config to prevent it from showing up in the log.\n            $config['key-pass'] = 'REDACTED';\n        }\n\n        return new class ($config) implements OutputTransformerFactoryInterface {\n            /** @var array */\n            private $config;\n\n            public function __construct(array $config)\n            {\n                $this->config = $config;\n            }\n\n            public function createFor(ToolReportInterface $report): OutputTransformerInterface\n            {\n                return new class ($this->config, $report) implements OutputTransformerInterface {\n                    /** @var array */\n                    private $config;\n\n                    /** @var ToolReportInterface */\n                    private $report;\n\n                    /** @var BufferedLineReader */\n                    private $buffer;\n\n                    public function __construct(array $config, ToolReportInterface $report)\n                    {\n                        $this->config = $config;\n                        $this->report = $report;\n                        $this->buffer = BufferedLineReader::create();\n                    }\n\n                    public function write(string $data, int $channel): void\n                    {\n                        $this->buffer->push($data);\n                    }\n\n                    public function finish(int $exitCode): void\n                    {\n                        $data = [];\n                        while (null !== $line = $this->buffer->fetch()) {\n                            $data[] = $line;\n                        }\n\n                        $config = json_encode(\n                            $this->config,\n                            JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE\n                        );\n                        $this->report->addAttachment('config.json')->fromString($config)->end();\n                        $this->report->addAttachment('execution.log')->fromString(implode(\"\\n\", $data))->end();\n                        $this->report->close(\n                            0 === $exitCode\n                                ? ToolReportInterface::STATUS_PASSED\n                                : ToolReportInterface::STATUS_FAILED\n                        );\n                    }\n                };\n            }\n        };\n    }\n};\n","hash":{"type":"sha-512","value":"f55050342115996f05a714be01c5b78d68e6d7c5886e43d9c4096fe501aa1c3da625a4257446e531d46f39645d8986ec4c6ee9c7cbedc27aa439484f501a2766"}}},"phars":{"box":[{"version":"3.8.4","phar-url":"https://github.com/humbug/box/releases/download/3.8.4/box.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.2","ext-phar":"*"},"hash":null,"signature":null},{"version":"3.8.5","phar-url":"https://github.com/humbug/box/releases/download/3.8.5/box.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.2","ext-phar":"*"},"hash":null,"signature":null}]}}