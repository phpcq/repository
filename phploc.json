{"bootstraps":{"bootstrap-0":{"plugin-version":"1.0.0","type":"inline","code":"<?php\n\n/**\n * Tool home: https://github.com/sebastianbergmann/phploc\n */\n\nuse Phpcq\\PluginApi\\Version10\\BuildConfigInterface;\nuse Phpcq\\PluginApi\\Version10\\ConfigurationOptionsBuilderInterface;\nuse Phpcq\\PluginApi\\Version10\\ConfigurationPluginInterface;\nuse Phpcq\\PluginApi\\Version10\\OutputTransformerFactoryInterface;\nuse Phpcq\\PluginApi\\Version10\\OutputTransformerInterface;\nuse Phpcq\\PluginApi\\Version10\\ReportInterface;\nuse Phpcq\\PluginApi\\Version10\\ToolReportInterface;\n\nreturn new class implements ConfigurationPluginInterface {\n    public function getName(): string\n    {\n        return 'phploc';\n    }\n\n    public function describeOptions(ConfigurationOptionsBuilderInterface $configOptionsBuilder): void\n    {\n        $configOptionsBuilder->describeArrayOption('output', 'List of outputs to use.');\n\n        $configOptionsBuilder->describeArrayOption(\n            'custom_flags',\n            'Any custom flags to pass to phploc. For valid flags refer to the phploc documentation.'\n        );\n\n        $configOptionsBuilder->describeArrayOption('directories', 'Source directories to be analyzed with phploc.');\n    }\n\n    public function processConfig(array $config, BuildConfigInterface $buildConfig): iterable\n    {\n        [$should, $excluded] = $this->processDirectories($config['directories']);\n        $args = [\n            '--log-xml',\n            $logFile = $buildConfig->getUniqueTempFile($this, 'log.xml')\n        ];\n        if ([] !== $excluded) {\n            foreach ($excluded as $path) {\n                if ('' === ($path = trim($path))) {\n                    continue;\n                }\n                $args[] = '--exclude=' . $path;\n            }\n        }\n\n        if ([] !== ($values = $config['custom_flags'] ?? [])) {\n            foreach ($values as $value) {\n                $args[] = (string) $value;\n            }\n        }\n\n        yield $buildConfig\n            ->getTaskFactory()\n            ->buildRunPhar('phploc', array_merge($args, $should))\n            ->withOutputTransformer($this->createOutputTransformer($logFile))\n            ->withWorkingDirectory($buildConfig->getProjectConfiguration()->getProjectRootPath())\n            ->build();\n    }\n\n    /**\n     * Process the directory list.\n     *\n     * @param array $directories The directory list.\n     *\n     * @return array\n     */\n    private function processDirectories(array $directories): array\n    {\n        $should  = [];\n        $exclude = [];\n        foreach ($directories as $directory => $dirConfig) {\n            $should[] = $directory;\n            if (null !== $dirConfig) {\n                if (isset($dirConfig['excluded'])) {\n                    foreach ($dirConfig['excluded'] as $excl) {\n                        $exclude[] = $directory . '/' . $excl;\n                    }\n                }\n            }\n        }\n        return [$should, $exclude];\n    }\n\n    private function createOutputTransformer(string $xmlFile): OutputTransformerFactoryInterface\n    {\n        return new class ($xmlFile) implements OutputTransformerFactoryInterface {\n            private $xmlFile;\n\n            public function __construct(string $xmlFile)\n            {\n                $this->xmlFile = $xmlFile;\n            }\n\n            public function createFor(ToolReportInterface $report): OutputTransformerInterface\n            {\n                return new class ($this->xmlFile, $report) implements OutputTransformerInterface {\n                    private const DICTIONARY = [\n                        'ccn'   => 'Cyclomatic Complexity',\n                        'lloc'  => 'Logical Lines of Code',\n                        'ncloc' => 'Non-Comment Lines of Code (NCLOC)',\n                        'min'   => 'Minimum',\n                        'max'   => 'Maximum',\n                        'avg'   => 'Average',\n                    ];\n\n                    /** @var string */\n                    private $xmlFile;\n                    /** @var ToolReportInterface */\n                    private $report;\n\n                    public function __construct(string $xmlFile, ToolReportInterface $report)\n                    {\n                        $this->xmlFile = $xmlFile;\n                        $this->report  = $report;\n                    }\n\n                    public function write(string $data, int $channel): void\n                    {\n                    }\n\n                    public function finish(int $exitCode): void\n                    {\n                        $xmlDocument = new DOMDocument('1.0');\n                        $xmlDocument->load($this->xmlFile);\n                        $rootNode = $xmlDocument->firstChild;\n\n                        if (!$rootNode instanceof DOMNode) {\n                            $this->report->close(\n                                $exitCode === 0 ? ReportInterface::STATUS_PASSED : ReportInterface::STATUS_FAILED\n                            );\n                            return;\n                        }\n\n                        foreach ($rootNode->childNodes as $childNode) {\n                            if (!$childNode instanceof DOMElement) {\n                                continue;\n                            }\n                            $this->report\n                                ->addDiagnostic(\n                                    ToolReportInterface::SEVERITY_INFO,\n                                    sprintf('%s: %s', $this->createLabel($childNode->nodeName), $childNode->textContent)\n                                )\n                                ->fromSource($childNode->nodeName)\n                                ->withCategory('statistics');\n                        }\n\n                        $this->report->addAttachment('log.xml')\n                            ->fromFile($this->xmlFile)\n                            ->setMimeType('application/xml')\n                            ->end();\n\n                        $this->report->close(\n                            $exitCode === 0\n                                ? ReportInterface::STATUS_PASSED\n                                : ReportInterface::STATUS_FAILED\n                        );\n                    }\n\n                    private function createLabel(string $text): string\n                    {\n                        if (null !== ($translated = $this->translateWord($text))) {\n                            return $translated;\n                        }\n\n                        return ucfirst(\n                            implode(\n                                ' ',\n                                array_map(\n                                    function (string $word): string {\n                                        return $this->translateWord($word) ?: $word;\n                                    },\n                                    preg_split('/(?=[A-Z])/', $text)\n                                )\n                            )\n                        );\n                    }\n\n                    private function translateWord(string $text): ?string\n                    {\n                        return self::DICTIONARY[strtolower($text)] ?? null;\n                    }\n                };\n            }\n        };\n    }\n};\n"}},"phars":{"phploc":[{"version":"6.0.2","phar-url":"https://phar.phpunit.de/phploc-6.0.2.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.3","ext-dom":"*","ext-json":"*"},"hash":{"type":"sha-256","value":"1ccb826b0a55b9d77b17656ad72f9c90877737a4a4be3f1517dda73524bfb16e"},"signature":"https://phar.phpunit.de/phploc-6.0.2.phar.asc"},{"version":"6.0.1","phar-url":"https://phar.phpunit.de/phploc-6.0.1.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.3"},"hash":{"type":"sha-256","value":"543b587b04ff11b1d1eb9ea245249a6aab08ff40f4151b4bf3f0ff393a818e96"},"signature":"https://phar.phpunit.de/phploc-6.0.1.phar.asc"},{"version":"6.0.0","phar-url":"https://phar.phpunit.de/phploc-6.0.0.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.3"},"hash":{"type":"sha-256","value":"49145e07cd94491608f25a045ed860b78ab2dd291e2a9570254d189ed2abfd06"},"signature":"https://phar.phpunit.de/phploc-6.0.0.phar.asc"},{"version":"5.0.0","phar-url":"https://phar.phpunit.de/phploc-5.0.0.phar","bootstrap":"bootstrap-0","requirements":{"php":"^7.2"},"hash":{"type":"sha-256","value":"1399c8025f87bc6021697ce3476ebc6e57c647e47b22d4558ab82784af48b1d8"},"signature":"https://phar.phpunit.de/phploc-5.0.0.phar.asc"},{"version":"4.0.1","phar-url":"https://phar.phpunit.de/phploc-4.0.1.phar","bootstrap":"bootstrap-0","requirements":{"php":"^5.6 || ^7.0"},"hash":{"type":"sha-256","value":"626b7320984ecd400dee8da9ebd10c3527084f698de640d9bfd5d03564743582"},"signature":"https://phar.phpunit.de/phploc-4.0.1.phar.asc"},{"version":"4.0.0","phar-url":"https://phar.phpunit.de/phploc-4.0.0.phar","bootstrap":"bootstrap-0","requirements":{"php":"^5.6 || ^7.0"},"hash":{"type":"sha-256","value":"6b26f5b39e0b54e39892acfd049e7f408fa20b8f12ca8e38a6d01707165a6b95"},"signature":"https://phar.phpunit.de/phploc-4.0.0.phar.asc"},{"version":"3.0.1","phar-url":"https://phar.phpunit.de/phploc-3.0.1.phar","bootstrap":"bootstrap-0","requirements":{"php":">=5.6"},"hash":{"type":"sha-256","value":"a712dec6b1044505a411d207813c6b11cc1c138c0ed467f65788b6f9441c9701"},"signature":"https://phar.phpunit.de/phploc-3.0.1.phar.asc"},{"version":"3.0.0","phar-url":"https://phar.phpunit.de/phploc-3.0.0.phar","bootstrap":"bootstrap-0","requirements":{"php":">=5.6"},"hash":{"type":"sha-256","value":"2d5ed6990f056c7cfbfadf03c926b39370ac9afde66747c30f50d2594bff6dca"},"signature":"https://phar.phpunit.de/phploc-3.0.0.phar.asc"},{"version":"2.1.5","phar-url":"https://phar.phpunit.de/phploc-2.1.5.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"dff1369013230e82856fa7f75ed95461d31bb9a08533f1f6c76ae90d7781ea45"},"signature":"https://phar.phpunit.de/phploc-2.1.5.phar.asc"},{"version":"2.1.4","phar-url":"https://phar.phpunit.de/phploc-2.1.4.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"4840c81119cef3dd9c154517e95570fddbebe432fedc6682a2878bf362ed8201"},"signature":"https://phar.phpunit.de/phploc-2.1.4.phar.asc"},{"version":"2.1.3","phar-url":"https://phar.phpunit.de/phploc-2.1.3.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"2d84fac491cdf9eb00fa6fff5ea61b6086b6924eb85c4b3ae48a2ab99279c745"},"signature":"https://phar.phpunit.de/phploc-2.1.3.phar.asc"},{"version":"2.1.2","phar-url":"https://phar.phpunit.de/phploc-2.1.2.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"6b6ed74e917ea44594a18be48194213b3825976f1a9f24baca334b07217b9217"},"signature":"https://phar.phpunit.de/phploc-2.1.2.phar.asc"},{"version":"2.1.1","phar-url":"https://phar.phpunit.de/phploc-2.1.1.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"01ef652dff211dc1409ee573e0030026eef56671f3e3a02b6c17c47be9b65853"},"signature":"https://phar.phpunit.de/phploc-2.1.1.phar.asc"},{"version":"2.1.0","phar-url":"https://phar.phpunit.de/phploc-2.1.0.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"413026cb8d601ffd2dc0d5906566d32b59fca2b5cc6569c077d4888a459d4bdb"},"signature":"https://phar.phpunit.de/phploc-2.1.0.phar.asc"},{"version":"2.0.6","phar-url":"https://phar.phpunit.de/phploc-2.0.6.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"d66ca3fbe3d144ecc432ac6c686b71c20828b7c3c93e581d2156178a5c824fb0"},"signature":"https://phar.phpunit.de/phploc-2.0.6.phar.asc"},{"version":"2.0.5","phar-url":"https://phar.phpunit.de/phploc-2.0.5.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"bcb17818068d5d3ee33c0a8d679d10f6be996421a34dd6e28b28498592ffa511"},"signature":"https://phar.phpunit.de/phploc-2.0.5.phar.asc"},{"version":"2.0.4","phar-url":"https://phar.phpunit.de/phploc-2.0.4.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"c98074382aaeb10ffbdc1ff80b2fab3a474eb5c55d6282c7c69ecfb821aeac4a"},"signature":"https://phar.phpunit.de/phploc-2.0.4.phar.asc"},{"version":"2.0.3","phar-url":"https://phar.phpunit.de/phploc-2.0.3.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"3b603f2426da280956392c0d844eafef28f843141124b88a520bced567e4ef3b"},"signature":"https://phar.phpunit.de/phploc-2.0.3.phar.asc"},{"version":"2.0.2","phar-url":"https://phar.phpunit.de/phploc-2.0.2.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"0ce805f48d778c49ae78af0b08a16efd2eba01ff31aa59e5374fad27e93c5558"},"signature":"https://phar.phpunit.de/phploc-2.0.2.phar.asc"},{"version":"2.0.1","phar-url":"https://phar.phpunit.de/phploc-2.0.1.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"6a6c55bd573e82bba4e6688561b8bb474e7aaeed6e9e2a808be95261022bc101"},"signature":"https://phar.phpunit.de/phploc-2.0.1.phar.asc"},{"version":"2.0.0","phar-url":"https://phar.phpunit.de/phploc-2.0.0.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"b674e1eb907fcffb0420c3d579f4040f22abda5248ffaaabb41f3e55230f6a83"},"signature":"https://phar.phpunit.de/phploc-2.0.0.phar.asc"},{"version":"1.7.4","phar-url":"https://phar.phpunit.de/phploc-1.7.4.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"7bfcc8ef6c741a7f87ec31a3f542e4be89638c70ec2311738a5fd6344d81edff"},"signature":"https://phar.phpunit.de/phploc-1.7.4.phar.asc"},{"version":"1.7.3","phar-url":"https://phar.phpunit.de/phploc-1.7.3.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"cda083fd0c770aef825acd3a1cd039beed11b8680f4820fa3a8a351cebacb46f"},"signature":"https://phar.phpunit.de/phploc-1.7.3.phar.asc"},{"version":"1.7.2","phar-url":"https://phar.phpunit.de/phploc-1.7.2.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"ac687a7cef191e69f2a0725ea410d4f8f3823f24a48176ab23ff95f20b0b9bc3"},"signature":"https://phar.phpunit.de/phploc-1.7.2.phar.asc"},{"version":"1.7.1","phar-url":"https://phar.phpunit.de/phploc-1.7.1.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"e40803ad5b71c78d2d1935508c57d35927dab96e32b41b80f1efcb1a9ee9393c"},"signature":"https://phar.phpunit.de/phploc-1.7.1.phar.asc"},{"version":"1.7.0","phar-url":"https://phar.phpunit.de/phploc-1.7.0.phar","bootstrap":"bootstrap-0","requirements":{},"hash":{"type":"sha-256","value":"e4d8eec06445387ca23e4910926cb77fbfc5378a44fb7f37d1e9db0173fdb1b2"},"signature":"https://phar.phpunit.de/phploc-1.7.0.phar.asc"}]}}